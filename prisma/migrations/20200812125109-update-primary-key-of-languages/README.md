# Migration `20200812125109-update-primary-key-of-languages`

This migration has been generated by Alexandre at 8/12/2020, 2:51:09 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."LanguagesOnTranslations" DROP CONSTRAINT "LanguagesOnTranslations_languageId_fkey"

ALTER TABLE "public"."_LanguageToProject" DROP CONSTRAINT "_LanguageToProject_A_fkey"

ALTER TABLE "public"."Language" DROP CONSTRAINT "Language_pkey",
DROP COLUMN "id",
ADD PRIMARY KEY ("code");

ALTER TABLE "public"."LanguagesOnTranslations" DROP CONSTRAINT "LanguagesOnTranslations_pkey",
DROP COLUMN "languageId",
ADD COLUMN "languageCode" text  NOT NULL ,
ADD PRIMARY KEY ("translationId", "languageCode");

ALTER TABLE "public"."_LanguageToProject" ALTER COLUMN "A" SET DATA TYPE text ;

ALTER TABLE "public"."LanguagesOnTranslations" ADD FOREIGN KEY ("languageCode")REFERENCES "public"."Language"("code") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_LanguageToProject" ADD FOREIGN KEY ("A")REFERENCES "public"."Language"("code") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200810210350-init..20200812125109-update-primary-key-of-languages
--- datamodel.dml
+++ datamodel.dml
@@ -6,18 +6,17 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Language {
-  id    Int @id @default(autoincrement())
-  index Int @default(autoincrement())
+  code  String @id
+  index Int    @default(autoincrement())
   name String
   slug String
-  code String
   rtl  Boolean @default(false)
   projects     Project[]
   translations LanguagesOnTranslations[]
@@ -88,13 +87,13 @@
   updatedAt DateTime @updatedAt
 }
 model LanguagesOnTranslations {
-  @@id([translationId, languageId])
+  @@id([translationId, languageCode])
   translation   Translation @relation(fields: [translationId], references: [id])
   translationId Int
-  language      Language    @relation(fields: [languageId], references: [id])
-  languageId    Int
+  language      Language    @relation(fields: [languageCode], references: [code])
+  languageCode  String
   value String
 }
```


